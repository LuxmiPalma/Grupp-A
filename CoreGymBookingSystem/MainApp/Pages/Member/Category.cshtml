@page
@using Microsoft.AspNetCore.Authorization
@model MainApp.Pages.Member.CategoryModel
@attribute [Authorize(Roles = "Member")]
@{
    ViewData["Title"] = "Category Search";
    Layout = "_GymLayout";
}

<section class="class-timetable-section spad" style="min-height:100vh; padding-top:140px;">
    <div class="container" style="max-width:900px; background-color:#111; border-radius:16px; padding:40px; box-shadow:0 0 12px rgba(0,0,0,0.4); color:#fff;">

        <!-- Header -->
        <div class="text-center mb-5">
            <h2 class="text-uppercase" style="color:#f36100;">Search by Category</h2>
            <p class="text-muted" style="color:#aaa;">
                Find your next class by selecting or searching for a category.
            </p>
        </div>

        <!-- SEARCH FORM -->
        <form method="get" class="mb-4">

            <label class="form-label fw-bold text-uppercase" style="color:#f36100;">Category</label>

            <div class="input-group input-group-lg mb-3">
                <span class="input-group-text bg-dark border-secondary text-white-50">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                        <path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" />
                    </svg>
                </span>

                <input type="text"
                       class="form-control bg-dark text-light border-secondary"
                       id="CategoryInput"
                       name="SelectedCategory"
                       placeholder="Yoga, Cardio, Bodybuilding..."
                       value="@Model.SelectedCategory" />

                <button class="btn px-4" type="submit"
                        style="background-color:#f36100; border:none; color:white;">
                    Search
                </button>

                <a href="@Url.Page(null, new { SelectedCategory = (string?)null })"
                   class="btn btn-outline-secondary px-3">
                    Clear
                </a>
            </div>

            <!-- Quick Category Buttons -->
            <div class="d-flex flex-wrap gap-2">
                @foreach (var c in new[] { "Yoga", "Running", "Weightloss", "Cardio", "Bodybuilding", "Nutrition" })
                {
                    <button type="button"
                            class="btn btn-sm btn-outline-light rounded-pill quick-cat"
                            data-value="@c">
                        @c
                    </button>
                }
            </div>

        </form>

        <!-- RESULTS SECTION -->
        <div class="mt-4">

            @if (!string.IsNullOrWhiteSpace(Model.SelectedCategory))
            {
                var total = Model.SearchbyCategory?.Count() ?? 0;

                <!-- Tag + Count -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge rounded-pill"
                              style="background-color:#f36100;">
                            @Model.SelectedCategory
                        </span>
                        <span class="text-muted small">@total result(s)</span>
                    </div>

                    <a href="@Url.Page(null, new { SelectedCategory = (string?)null })"
                       class="btn btn-sm btn-outline-light">
                        Reset
                    </a>
                </div>

                <!-- Results Table/Card -->
                @if (total > 0)
                {
                    <div class="card border-0 rounded-3"
                         style="background-color:#1a1a1a; color:white;">

                        <div class="table-responsive">
                            <table class="table table-dark table-borderless align-middle mb-0">
                                <thead class="border-bottom border-secondary">
                                    <tr class="text-uppercase text-secondary small">
                                        <th>Session</th>
                                        <th class="text-end">Category</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var s in Model.SearchbyCategory!)
                                    {
                                        <tr class="border-bottom border-secondary">
                                            <td>
                                                <div class="fw-bold">@s.Title</div>
                                                <div class="text-muted small">@s.Description</div>
                                            </td>
                                            <td class="text-end">
                                                <span class="badge rounded-pill bg-secondary">@s.Category</span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                    </div>
                }
                else
                {
                    <div class="text-center py-5">
                        <p class="fw-bold">No sessions found.</p>
                        <p class="text-muted small">Try another category.</p>
                    </div>
                }
            }
            else
            {
                <div class="alert alert-dark border-secondary">
                    Start by typing a category or choose one of the suggestions above.
                </div>
            }

        </div>

    </div>
</section>

@section Scripts {
    <script>
        // Quick category chips & sidebar links
        (function () {
            const input = document.getElementById('CategoryInput');
            const form = input?.closest('form');

            document.querySelectorAll('.quick-cat').forEach(btn => {
                btn.addEventListener('click', e => {
                    e.preventDefault();
                    const value = btn.dataset.value;
                    if (input && form) {
                        input.value = value;
                        form.submit();
                    }
                });
            });
        })();
    </script>
}
