@page
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]
@{
    Layout = "_GymLayout";
    ViewData["Title"] = "Admin – Session Details";
}

<!-- Breadcrumb -->
<section class="breadcrumb-section set-bg" data-setbg="/Gym_Tem/img/breadcrumb-bg.jpg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb-text">
                    <h2>Session Details</h2>
                    <div class="bt-option">
                        <a href="/Index">Home</a>
                        <a href="/Admin/Dashboard">Admin</a>
                        <span>Session Details</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="contact-section spad">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card" style="background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);">
                    <div class="card-body">
                        <h3 id="s-title" class="mb-3">—</h3>
                        <p id="s-desc" class="text-muted">—</p>
                        <hr />
                        <dl class="row" style="color:#fff;">
                            <dt class="col-sm-3">Coach</dt>
                            <dd id="s-coach" class="col-sm-9">—</dd>
                            <dt class="col-sm-3">Time</dt>
                            <dd id="s-time" class="col-sm-9">—</dd>
                            <dt class="col-sm-3">Room</dt>
                            <dd id="s-room" class="col-sm-9">—</dd>
                            <dt class="col-sm-3">Spots</dt>
                            <dd id="s-spots" class="col-sm-9">—</dd>
                            <dt class="col-sm-3">Type</dt>
                            <dd id="s-type" class="col-sm-9">—</dd>
                            <dt class="col-sm-3">Status</dt>
                            <dd id="s-status" class="col-sm-9">—</dd>
                            <dt class="col-sm-3">Created</dt>
                            <dd id="s-created" class="col-sm-9">—</dd>
                            <dt class="col-sm-3">Updated</dt>
                            <dd id="s-updated" class="col-sm-9">—</dd>
                        </dl>
                        <div class="d-flex gap-2 mt-3">
                            <a href="/Admin/Sessions/Edit" class="site-btn">Edit</a>
                            <button id="btn-cancel" class="site-btn" style="background:#a33;">Cancel</button>
                            <a href="/Admin/Dashboard" class="site-btn" style="opacity:.85;">Back</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar: attendees -->
            <div class="col-lg-4">
                <div class="card" style="background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);">
                    <div class="card-body">
                        <h5 class="mb-3">Attendees</h5>
                        <ul id="s-attendees" class="list-unstyled mb-0" style="line-height:1.9;">
                            <!-- JS render -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" style="display:none; position:fixed; right:18px; bottom:18px; background:#222; color:#fff; padding:12px 16px; border-radius:8px;">—</div>
    </div>
</section>

@section Scripts {
    <script>
        // ---- Mock: get id from query (e.g. ?id=s1) and find in mockSessions ----
        const mockSessions = [
          { id:"s1", title:"Morning Yoga", coach:"Elin Ek", start:"2025-11-02T07:00:00", end:"2025-11-02T08:00:00", room:"A1", capacity:20, enrolled:18, type:"Yoga", status:"Open", created:"2025-10-01T09:00:00Z", updated:"2025-10-20T14:22:00Z", desc:"A calm morning class focusing on breathing and mobility.", attendees:["alice@example.com","carla@example.com","farah@example.com"] },
          { id:"s2", title:"HIIT Express", coach:"Bertil Berg", start:"2025-11-02T12:15:00", end:"2025-11-02T12:45:00", room:"B2", capacity:15, enrolled:15, type:"HIIT", status:"Full", created:"2025-10-02T10:00:00Z", updated:"2025-10-22T10:15:00Z", desc:"Intense lunchtime session – get sweaty fast!", attendees:["elin@example.com","goran@example.com"] },
        ];

        const qs = new URLSearchParams(location.search);
        const id = qs.get("id") || "s1";
        const session = mockSessions.find(s=>s.id===id) || mockSessions[0];

        const fmt = iso => {
          const d=new Date(iso); const y=d.getFullYear();
          const m=String(d.getMonth()+1).padStart(2,'0');
          const day=String(d.getDate()).padStart(2,'0');
          const hh=String(d.getHours()).padStart(2,'0');
          const mm=String(d.getMinutes()).padStart(2,'0');
          return `${y}-${m}-${day} ${hh}:${mm}`;
        };

        function render(){
          document.getElementById('s-title').textContent = session.title;
          document.getElementById('s-desc').textContent = session.desc || "—";
          document.getElementById('s-coach').textContent = session.coach;
          document.getElementById('s-time').textContent = `${fmt(session.start)} – ${fmt(session.end)}`;
          document.getElementById('s-room').textContent = session.room;
          document.getElementById('s-spots').textContent = `${session.enrolled}/${session.capacity}`;
          document.getElementById('s-type').textContent = session.type;
          document.getElementById('s-status').textContent = session.status;
          document.getElementById('s-created').textContent = fmt(session.created);
          document.getElementById('s-updated').textContent = fmt(session.updated);

          const ul = document.getElementById('s-attendees');
          ul.innerHTML = "";
          (session.attendees || []).forEach(a=>{
            const li = document.createElement('li');
            li.textContent = a;
            ul.appendChild(li);
          });
        }

        function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none', 2200); }

        document.getElementById('btn-cancel').addEventListener('click', ()=>{
          toast('The session was marked as cancelled (demo).');
        });

        render();
    </script>
}
