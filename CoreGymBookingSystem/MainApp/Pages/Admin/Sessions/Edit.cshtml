@page
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]
@{
    Layout = "_GymLayout";
    ViewData["Title"] = "Admin – Edit Session";
}

<!-- Breadcrumb -->
<section class="breadcrumb-section set-bg" data-setbg="/Gym_Tem/img/breadcrumb-bg.jpg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb-text">
                    <h2>Edit Session</h2>
                    <div class="bt-option">
                        <a href="/Index">Home</a>
                        <a href="/Admin/Dashboard">Admin</a>
                        <span>Edit Session</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="contact-section spad">
    <div class="container">
        <form id="sess-form" onsubmit="return false;">
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card" style="background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);">
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-8">
                                    <label class="form-label">Title</label>
                                    <input id="f-title" class="form-control" placeholder="e.g. Morning Yoga" required />
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Coach</label>
                                    <input id="f-coach" class="form-control" placeholder="e.g. Elin Ek" required />
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">Start</label>
                                    <input id="f-start" type="datetime-local" class="form-control" required />
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">End</label>
                                    <input id="f-end" type="datetime-local" class="form-control" required />
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label">Room</label>
                                    <input id="f-room" class="form-control" placeholder="A1" />
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Capacity</label>
                                    <input id="f-capacity" type="number" min="1" class="form-control" value="20" required />
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Type</label>
                                    <select id="f-type" class="form-select">
                                        <option value="">Choose...</option>
                                        <option>Yoga</option>
                                        <option>HIIT</option>
                                        <option>Boxing</option>
                                        <option>Strength</option>
                                    </select>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label">Status</label>
                                    <select id="f-status" class="form-select">
                                        <option>Open</option>
                                        <option>Full</option>
                                        <option>Cancelled</option>
                                    </select>
                                </div>
                                <div class="col-md-8">
                                    <label class="form-label">Description</label>
                                    <textarea id="f-desc" class="form-control" rows="3" placeholder="Short description..."></textarea>
                                </div>
                            </div>

                            <div class="d-flex gap-2 mt-4">
                                <button id="btn-save" class="site-btn" type="button">Save</button>
                                <button id="btn-delete" class="site-btn" type="button" style="background:#a33;">Delete</button>
                                <a href="/Admin/Sessions/Details" class="site-btn" style="opacity:.85;">Cancel</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar: preview & meta -->
                <div class="col-lg-4">
                    <div class="card" style="background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);">
                        <div class="card-body">
                            <h5 class="mb-3">Preview</h5>
                            <div id="preview" style="line-height:1.9;">
                                <div><strong id="p-title">—</strong></div>
                                <div id="p-time" class="text-muted">—</div>
                                <div><span id="p-coach">—</span> • <span id="p-room">—</span></div>
                                <div><span id="p-capacity">—</span> • <span id="p-type">—</span> • <span id="p-status">—</span></div>
                            </div>
                            <hr />
                            <small class="text-muted">Created: <span id="p-created">—</span></small><br />
                            <small class="text-muted">Updated: <span id="p-updated">—</span></small>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- Toast -->
        <div id="toast" style="display:none; position:fixed; right:18px; bottom:18px; background:#222; color:#fff; padding:12px 16px; border-radius:8px;">—</div>
    </div>
</section>

@section Scripts {
    <script>
        // ---- Mock current session (normally: fetch via API) ----
        const qs = new URLSearchParams(location.search);
        const id = qs.get("id") || "s1";

        let session = {
          id,
          title:"Morning Yoga",
          coach:"Elin Ek",
          start:"2025-11-02T07:00",
          end:"2025-11-02T08:00",
          room:"A1",
          capacity:20,
          enrolled:18,
          type:"Yoga",
          status:"Open",
          desc:"A calm morning class focusing on breathing and mobility.",
          created:"2025-10-01T09:00:00Z",
          updated:"2025-10-20T14:22:00Z",
        };

        const el = id => document.getElementById(id);
        const fmt = iso => {
          const d=new Date(iso);
          const y=d.getFullYear();
          const m=String(d.getMonth()+1).padStart(2,'0');
          const day=String(d.getDate()).padStart(2,'0');
          const hh=String(d.getHours()).padStart(2,'0');
          const mm=String(d.getMinutes()).padStart(2,'0');
          return `${y}-${m}-${day} ${hh}:${mm}`;
        };

        function loadForm(){
          el('f-title').value   = session.title;
          el('f-coach').value   = session.coach;
          el('f-start').value   = session.start;
          el('f-end').value     = session.end;
          el('f-room').value    = session.room;
          el('f-capacity').value= session.capacity;
          el('f-type').value    = session.type;
          el('f-status').value  = session.status;
          el('f-desc').value    = session.desc;

          // preview/meta
          refreshPreview();
          el('p-created').textContent = fmt(session.created);
          el('p-updated').textContent = fmt(session.updated);
        }

        function refreshPreview(){
          el('p-title').textContent = el('f-title').value || "—";
          el('p-coach').textContent = el('f-coach').value || "—";
          el('p-room').textContent  = el('f-room').value || "—";
          el('p-capacity').textContent = `${el('f-enrolled')?.value || session.enrolled}/${el('f-capacity').value || session.capacity}`;
          el('p-type').textContent  = el('f-type').value || "—";
          el('p-status').textContent= el('f-status').value || "—";
          const s = el('f-start').value, e = el('f-end').value;
          el('p-time').textContent = (s && e) ? `${fmt(s)} – ${fmt(e)}` : "—";
        }

        ['f-title','f-coach','f-start','f-end','f-room','f-capacity','f-type','f-status','f-desc']
          .forEach(id=> document.addEventListener('input', e=> { if(e.target.id===id) refreshPreview(); }));

        function toast(msg){ const t=el('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none', 2200); }

        function validate(){
          const required = ['f-title','f-coach','f-start','f-end','f-capacity'];
          for(const rid of required){
            if(!el(rid).value.trim()){ toast('Please fill in all required fields.'); return false; }
          }
          if(new Date(el('f-end').value) <= new Date(el('f-start').value)){
            toast('End time must be after start time.'); return false;
          }
          return true;
        }

        el('btn-save').addEventListener('click', ()=>{
          if(!validate()) return;
          // Mock "save"
          session = {
            ...session,
            title: el('f-title').value.trim(),
            coach: el('f-coach').value.trim(),
            start: el('f-start').value,
            end: el('f-end').value,
            room: el('f-room').value.trim(),
            capacity: Number(el('f-capacity').value),
            type: el('f-type').value,
            status: el('f-status').value,
            desc: el('f-desc').value.trim(),
            updated: new Date().toISOString(),
          };
          el('p-updated').textContent = fmt(session.updated);
          toast('Session saved (demo).');

        });

        el('btn-delete').addEventListener('click', ()=>{
          if(confirm('Do you want to delete the session? (demo)')){
            toast('Session deleted (demo).');

          }
        });

        loadForm();
    </script>
}
